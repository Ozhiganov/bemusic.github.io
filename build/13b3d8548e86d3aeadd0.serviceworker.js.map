{"version":3,"sources":["webpack:///13b3d8548e86d3aeadd0.serviceworker.js","webpack:///webpack/bootstrap 13b3d8548e86d3aeadd0","webpack:///./app/service-worker.js","webpack:///./utils/version.js","webpack:///../~/serviceworker-cache-polyfill/index.js","webpack:///./utils/version-loader.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","log","_len","arguments","length","args","Array","_key","console","apply","concat","cacheForever","event","cacheName","respondWith","caches","open","then","cache","match","request","cached","fetch","response","url","put","clone","fetchThenCache","ok","staleWhileRevalidate","promise","_bemuseUtilsVersion","_bemuseUtilsVersion2","APP_CACHE_KEY","SITE_CACHE_KEY","RES_CACHE_KEY","SKIN_CACHE_KEY","SONG_CACHE_KEY","self","addEventListener","waitUntil","addAll","build","location","origin","skin","res","site","startsWith","Cache","prototype","add","this","requests","NetworkError","message","name","code","Object","create","Error","Promise","resolve","TypeError","map","Request","String","all","scheme","URL","protocol","responses","i","undefined"],"mappings":"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","file":"13b3d8548e86d3aeadd0.serviceworker.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"build/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\n\t/*global caches*/\n\t'use strict';\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\t\n\tvar _bemuseUtilsVersion = __webpack_require__(1);\n\t\n\tvar _bemuseUtilsVersion2 = _interopRequireDefault(_bemuseUtilsVersion);\n\t\n\t__webpack_require__(2);\n\t\n\tfunction log() {\n\t  for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t    args[_key] = arguments[_key];\n\t  }\n\t\n\t  console.log.apply(console, ['[serviceworker]'].concat(args));\n\t}\n\t\n\tlog('I am a service worker! ' + _bemuseUtilsVersion2['default']);\n\t\n\tvar APP_CACHE_KEY = 'app';\n\tvar SITE_CACHE_KEY = 'site-v' + _bemuseUtilsVersion2['default'];\n\tvar RES_CACHE_KEY = 'site-v' + _bemuseUtilsVersion2['default'];\n\tvar SKIN_CACHE_KEY = 'skin-v' + _bemuseUtilsVersion2['default'];\n\tvar SONG_CACHE_KEY = 'songs';\n\t\n\tself.addEventListener('install', function (event) {\n\t  event.waitUntil(caches.open(SITE_CACHE_KEY).then(function (cache) {\n\t    return cache.addAll(['/']);\n\t  }));\n\t});\n\t\n\tself.addEventListener('activate', function () {\n\t  log('Service worker activated!');\n\t});\n\t\n\tself.addEventListener('fetch', function (event) {\n\t  var build = location.origin + '/build/';\n\t  var skin = location.origin + '/skins/';\n\t  var res = location.origin + '/res/';\n\t  var site = location.origin;\n\t  var request = event.request;\n\t  if (request.url.startsWith(build)) {\n\t    if (request.url !== build + 'boot.js') {\n\t      return cacheForever(event, APP_CACHE_KEY);\n\t    }\n\t  }\n\t  if (request.url.match(/assets\\/[^\\/]+\\.bemuse$/)) {\n\t    return cacheForever(event, SONG_CACHE_KEY);\n\t  }\n\t  if (request.url.match(/\\.(bms|bme|bml)$/)) {\n\t    return fetchThenCache(event, SONG_CACHE_KEY);\n\t  }\n\t  if (request.url.match(/\\/index\\.json$/)) {\n\t    return fetchThenCache(event, SONG_CACHE_KEY);\n\t  }\n\t  if (request.url.match(/\\/assets\\/metadata\\.json$/)) {\n\t    return fetchThenCache(event, SONG_CACHE_KEY);\n\t  }\n\t  if (request.url.startsWith(skin)) {\n\t    return staleWhileRevalidate(event, SKIN_CACHE_KEY);\n\t  }\n\t  if (request.url.startsWith(res)) {\n\t    return staleWhileRevalidate(event, RES_CACHE_KEY);\n\t  }\n\t  if (request.url.startsWith(site)) {\n\t    return fetchThenCache(event, SITE_CACHE_KEY);\n\t  }\n\t  if (request.url.startsWith('https://fonts.googleapis.com/')) {\n\t    return staleWhileRevalidate(event, SKIN_CACHE_KEY);\n\t  }\n\t});\n\t\n\tfunction cacheForever(event, cacheName) {\n\t  event.respondWith(caches.open(cacheName).then(function (cache) {\n\t    return cache.match(event.request).then(function (cached) {\n\t      return cached || fetch(event.request).then(function (response) {\n\t        log('[caching forever]', event.request.url);\n\t        cache.put(event.request, response.clone());\n\t        return response;\n\t      });\n\t    });\n\t  }));\n\t}\n\t\n\tfunction fetchThenCache(event, cacheName) {\n\t  event.respondWith(caches.open(cacheName).then(function (cache) {\n\t    return fetch(event.request).then(function (response) {\n\t      if (response && response.ok) {\n\t        log('[cached]', event.request.url);\n\t        cache.put(event.request, response.clone());\n\t        return response;\n\t      } else {\n\t        return cache.match(event.request);\n\t      }\n\t    })['catch'](function () {\n\t      return cache.match(event.request);\n\t    });\n\t  }));\n\t}\n\t\n\tfunction staleWhileRevalidate(event, cacheName) {\n\t  event.respondWith(caches.open(cacheName).then(function (cache) {\n\t    return cache.match(event.request).then(function (cached) {\n\t      var promise = fetch(event.request).then(function (response) {\n\t        if (response && response.ok) {\n\t          log('[updated]', event.request.url);\n\t          cache.put(event.request, response.clone());\n\t        }\n\t        return response;\n\t      });\n\t      return cached || promise;\n\t    });\n\t  }));\n\t}\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tmodule.exports = __webpack_require__(3);\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tif (!Cache.prototype.add) {\n\t  Cache.prototype.add = function add(request) {\n\t    return this.addAll([request]);\n\t  };\n\t}\n\t\n\tif (!Cache.prototype.addAll) {\n\t  Cache.prototype.addAll = function addAll(requests) {\n\t    var cache = this;\n\t\n\t    // Since DOMExceptions are not constructable:\n\t    function NetworkError(message) {\n\t      this.name = 'NetworkError';\n\t      this.code = 19;\n\t      this.message = message;\n\t    }\n\t    NetworkError.prototype = Object.create(Error.prototype);\n\t\n\t    return Promise.resolve().then(function() {\n\t      if (arguments.length < 1) throw new TypeError();\n\t      \n\t      // Simulate sequence<(Request or USVString)> binding:\n\t      var sequence = [];\n\t\n\t      requests = requests.map(function(request) {\n\t        if (request instanceof Request) {\n\t          return request;\n\t        }\n\t        else {\n\t          return String(request); // may throw TypeError\n\t        }\n\t      });\n\t\n\t      return Promise.all(\n\t        requests.map(function(request) {\n\t          if (typeof request === 'string') {\n\t            request = new Request(request);\n\t          }\n\t\n\t          var scheme = new URL(request.url).protocol;\n\t\n\t          if (scheme !== 'http:' && scheme !== 'https:') {\n\t            throw new NetworkError(\"Invalid scheme\");\n\t          }\n\t\n\t          return fetch(request.clone());\n\t        })\n\t      );\n\t    }).then(function(responses) {\n\t      // TODO: check that requests don't overwrite one another\n\t      // (don't think this is possible to polyfill due to opaque responses)\n\t      return Promise.all(\n\t        responses.map(function(response, i) {\n\t          return cache.put(requests[i], response);\n\t        })\n\t      );\n\t    }).then(function() {\n\t      return undefined;\n\t    });\n\t  };\n\t}\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\tmodule.exports=\"1.0.0-beta.17.2\"\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** 13b3d8548e86d3aeadd0.serviceworker.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"build/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 13b3d8548e86d3aeadd0\n **/","\n/*global caches*/\nimport version from 'bemuse/utils/version'\nimport 'serviceworker-cache-polyfill'\n\nfunction log(...args){\n  console.log('[serviceworker]', ...args)\n}\n\nlog('I am a service worker! ' + version)\n\nvar APP_CACHE_KEY = 'app'\nvar SITE_CACHE_KEY = 'site-v' + version\nvar RES_CACHE_KEY = 'site-v' + version\nvar SKIN_CACHE_KEY = 'skin-v' + version\nvar SONG_CACHE_KEY = 'songs'\n\nself.addEventListener('install', function(event) {\n  event.waitUntil(\n    caches.open(SITE_CACHE_KEY).then(function(cache) {\n      return cache.addAll(['/'])\n    })\n  )\n})\n\nself.addEventListener('activate', function() {\n  log('Service worker activated!')\n})\n\nself.addEventListener('fetch', function(event) {\n  var build = location.origin + '/build/'\n  var skin = location.origin + '/skins/'\n  var res = location.origin + '/res/'\n  var site = location.origin\n  var request = event.request\n  if (request.url.startsWith(build)) {\n    if (request.url !== build + 'boot.js') {\n      return cacheForever(event, APP_CACHE_KEY)\n    }\n  }\n  if (request.url.match(/assets\\/[^\\/]+\\.bemuse$/)) {\n    return cacheForever(event, SONG_CACHE_KEY)\n  }\n  if (request.url.match(/\\.(bms|bme|bml)$/)) {\n    return fetchThenCache(event, SONG_CACHE_KEY)\n  }\n  if (request.url.match(/\\/index\\.json$/)) {\n    return fetchThenCache(event, SONG_CACHE_KEY)\n  }\n  if (request.url.match(/\\/assets\\/metadata\\.json$/)) {\n    return fetchThenCache(event, SONG_CACHE_KEY)\n  }\n  if (request.url.startsWith(skin)) {\n    return staleWhileRevalidate(event, SKIN_CACHE_KEY)\n  }\n  if (request.url.startsWith(res)){\n    return staleWhileRevalidate(event, RES_CACHE_KEY)\n  }\n  if (request.url.startsWith(site)) {\n    return fetchThenCache(event, SITE_CACHE_KEY)\n  }\n  if (request.url.startsWith('https://fonts.googleapis.com/')) {\n    return staleWhileRevalidate(event, SKIN_CACHE_KEY)\n  }\n})\n\nfunction cacheForever(event, cacheName) {\n  event.respondWith(\n    caches.open(cacheName).then(function(cache) {\n      return cache.match(event.request).then(function(cached) {\n        return cached || fetch(event.request).then(function(response) {\n          log('[caching forever]', event.request.url)\n          cache.put(event.request, response.clone())\n          return response\n        })\n      })\n    })\n  )\n}\n\nfunction fetchThenCache(event, cacheName) {\n  event.respondWith(\n    caches.open(cacheName).then(function(cache) {\n      return fetch(event.request).then(function(response) {\n        if (response && response.ok) {\n          log('[cached]', event.request.url)\n          cache.put(event.request, response.clone())\n          return response\n        } else {\n          return cache.match(event.request)\n        }\n      }).catch(function() {\n        return cache.match(event.request)\n      })\n    })\n  )\n}\n\nfunction staleWhileRevalidate(event, cacheName) {\n  event.respondWith(\n    caches.open(cacheName).then(function(cache) {\n      return cache.match(event.request).then(function(cached) {\n        var promise = fetch(event.request).then(function(response) {\n          if (response && response.ok) {\n            log('[updated]', event.request.url)\n            cache.put(event.request, response.clone())\n          }\n          return response\n        })\n        return cached || promise\n      })\n    })\n  )\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./app/service-worker.js\n **/","\nmodule.exports = require('val!./version-loader')\n\n\n\n/** WEBPACK FOOTER **\n ** ./utils/version.js\n **/","if (!Cache.prototype.add) {\n  Cache.prototype.add = function add(request) {\n    return this.addAll([request]);\n  };\n}\n\nif (!Cache.prototype.addAll) {\n  Cache.prototype.addAll = function addAll(requests) {\n    var cache = this;\n\n    // Since DOMExceptions are not constructable:\n    function NetworkError(message) {\n      this.name = 'NetworkError';\n      this.code = 19;\n      this.message = message;\n    }\n    NetworkError.prototype = Object.create(Error.prototype);\n\n    return Promise.resolve().then(function() {\n      if (arguments.length < 1) throw new TypeError();\n      \n      // Simulate sequence<(Request or USVString)> binding:\n      var sequence = [];\n\n      requests = requests.map(function(request) {\n        if (request instanceof Request) {\n          return request;\n        }\n        else {\n          return String(request); // may throw TypeError\n        }\n      });\n\n      return Promise.all(\n        requests.map(function(request) {\n          if (typeof request === 'string') {\n            request = new Request(request);\n          }\n\n          var scheme = new URL(request.url).protocol;\n\n          if (scheme !== 'http:' && scheme !== 'https:') {\n            throw new NetworkError(\"Invalid scheme\");\n          }\n\n          return fetch(request.clone());\n        })\n      );\n    }).then(function(responses) {\n      // TODO: check that requests don't overwrite one another\n      // (don't think this is possible to polyfill due to opaque responses)\n      return Promise.all(\n        responses.map(function(response, i) {\n          return cache.put(requests[i], response);\n        })\n      );\n    }).then(function() {\n      return undefined;\n    });\n  };\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ../~/serviceworker-cache-polyfill/index.js\n ** module id = 2\n ** module chunks = 0\n **/","module.exports=\"1.0.0-beta.17.2\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ../~/val-loader!./utils/version-loader.js\n ** module id = 3\n ** module chunks = 0\n **/"],"sourceRoot":""}